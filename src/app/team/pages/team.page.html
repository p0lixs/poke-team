<div class="layout">
    <section class="search-panel">
        <div class="search-panel__header">
            <div>
                <p class="eyebrow">Advanced search</p>
                <h2>Combine Pokédex filters</h2>
                <p class="muted">Search by name, types, abilities, and moves in a dedicated modal.</p>
            </div>
            <button type="button" class="primary" (click)="openSearchDialog()">Open search</button>
        </div>

        @if (facade.hasActiveFilters()) {
        <div class="active-filters">
            <p class="muted">Active filters</p>
            <div class="tag-grid">
                @for (type of facade.searchFilters().types; track type) {
                <span class="tag">Type: {{ type }}</span>
                }
                @for (ability of facade.searchFilters().abilities; track ability) {
                <span class="tag">Ability: {{ ability }}</span>
                }
                @for (move of facade.searchFilters().moves; track move) {
                <span class="tag">Move: {{ move }}</span>
                }
                @if (facade.searchFilters().name) {
                <span class="tag">Name: "{{ facade.searchFilters().name }}"</span>
                }
            </div>
            <p class="muted small">Filters stack together: types + abilities + moves.</p>
        </div>
        } @else {
        <p class="muted">Open the modal to add filters and find specific Pokémon.</p>
        }
    </section>

    <aside>
        <app-team-panel [team]="facade.team()" [teamName]="facade.teamName()" [savedTeams]="facade.savedTeams()"
            [selectedTeamId]="facade.selectedTeamId()" [items]="facade.itemOptions()" [natures]="facade.natureOptions()"
            (teamNameChange)="facade.setTeamName($event)" (selectTeam)="facade.selectTeam($event)"
            (createTeam)="facade.createCurrentTeam()" (remove)="facade.removeFromTeam($event)"
            (clear)="facade.clearTeam()" (moveChange)="facade.changePokemonMove($event)"
            (abilityChange)="facade.changePokemonAbility($event)" (itemChange)="facade.changePokemonItem($event)"
            (natureChange)="facade.changePokemonNature($event)" (levelChange)="facade.changePokemonLevel($event)"
            (statChange)="facade.changePokemonStats($event)" (teraTypeChange)="facade.changePokemonTeraType($event)"
            (openImport)="openImportDialog()" (openExport)="openExportDialog()"
            (openWeaknesses)="openWeaknessDialog()" />

        @if (showImportModal) {
        <app-import-team-modal [importText]="importText" [importError]="importError" [isImporting]="isImporting"
            (close)="closeImportDialog()" (confirm)="confirmImport()" (importTextChange)="importText = $event" />
        }

        @if (showExportModal) {
        <app-export-team-modal [exportText]="exportText" [copyStatus]="copyStatus" (close)="closeExportDialog()"
            (copy)="copyExportText()" />
        }

        @if (showWeaknessModal) {
        <app-team-weakness-modal [typeColumns]="typeColumns" [weaknessTable]="weaknessTable()"
            (close)="closeWeaknessDialog()" (toggleTeraType)="toggleTeraType($event)" />
        }
    </aside>
</div>

@if (showSearchModal) {
<app-search-modal [filters]="facade.searchFilters()" [typeOptions]="facade.typeOptions()"
    [abilityOptions]="facade.abilityOptions()" [moveOptions]="facade.moveOptions()" [results]="facade.results()"
    [loading]="facade.loading()" [error]="facade.error()" [hasMore]="facade.hasMoreResults()"
    (filtersChange)="facade.updateSearchFilters($event)" (add)="facade.addToTeam($event)"
    (loadMore)="facade.loadMoreResults()" (close)="closeSearchDialog()" />
}
