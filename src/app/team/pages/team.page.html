<div class="layout">
    <section>
        <app-search-box (valueChange)="facade.query.set($event)"></app-search-box>
        @if(facade.results().length > 0){
        <app-results-list [results]="facade.results()" (add)="facade.addToTeam($event)" />
        }
        @if(facade.loading()){
        <div class="muted" style="margin:.75rem 0">Searching...</div>
        }
        @if(facade.error()){
        <div style="color:red">{{ facade.error() }}</div>
        }
        @if(!facade.loading() && facade.results().length === 0){
        <p class="muted">
            Type at least 2 letters to search.
        </p>
        }
    </section>
    <aside>
        <app-team-panel
            [team]="facade.team()"
            [teamName]="facade.teamName()"
            [savedTeams]="facade.savedTeams()"
            [selectedTeamId]="facade.selectedTeamId()"
            [items]="facade.itemOptions()"
            [natures]="facade.natureOptions()"
            (teamNameChange)="facade.setTeamName($event)"
            (selectTeam)="facade.selectTeam($event)"
            (createTeam)="facade.createCurrentTeam()"
            (remove)="facade.removeFromTeam($event)"
            (clear)="facade.clearTeam()"
            (moveChange)="facade.changePokemonMove($event)"
            (abilityChange)="facade.changePokemonAbility($event)"
            (itemChange)="facade.changePokemonItem($event)"
            (natureChange)="facade.changePokemonNature($event)"
            (levelChange)="facade.changePokemonLevel($event)"
            (statChange)="facade.changePokemonStats($event)"
            (teraTypeChange)="facade.changePokemonTeraType($event)"
            (openImport)="openImportDialog()"
            (openExport)="openExportDialog()"
        />

        @if (showImportModal) {
        <div class="modal-backdrop" (click)="closeImportDialog()"></div>
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="import-title">
            <div class="modal__header">
                <h3 class="modal__title" id="import-title">Import team</h3>
                <button type="button" class="modal__close" (click)="closeImportDialog()" [disabled]="isImporting">×</button>
            </div>
            <div class="modal__body">
                <label class="modal__label" for="team-import-text">Team text</label>
                <textarea id="team-import-text" class="modal__textarea" [(ngModel)]="importText" placeholder="Paste your team here" [disabled]="isImporting"></textarea>
                @if (importError) {
                <p class="modal__error">{{ importError }}</p>
                }
            </div>
            <div class="modal__footer">
                <button type="button" class="modal__button" (click)="closeImportDialog()" [disabled]="isImporting">Cancel</button>
                <button type="button" class="modal__button modal__button--primary" (click)="confirmImport()" [disabled]="isImporting">Import</button>
            </div>
        </div>
        }

        @if (showExportModal) {
        <div class="modal-backdrop" (click)="closeExportDialog()"></div>
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="export-title">
            <div class="modal__header">
                <h3 class="modal__title" id="export-title">Export team</h3>
                <button type="button" class="modal__close" (click)="closeExportDialog()">×</button>
            </div>
            <div class="modal__body">
                <label class="modal__label" for="team-export-text">Team text</label>
                <textarea id="team-export-text" class="modal__textarea" [value]="exportText" readonly></textarea>
                <div class="modal__note">
                    @if (copyStatus === 'copied') {
                    <span class="modal__feedback modal__feedback--success">Copied to clipboard</span>
                    } @else if (copyStatus === 'error') {
                    <span class="modal__feedback modal__feedback--error">Copy failed. Select the text manually.</span>
                    } @else {
                    <span class="modal__feedback">Use the copy button or select the text manually.</span>
                    }
                </div>
            </div>
            <div class="modal__footer">
                <button type="button" class="modal__button" (click)="closeExportDialog()">Close</button>
                <button type="button" class="modal__button modal__button--primary" (click)="copyExportText()" [disabled]="!exportText">Copy</button>
            </div>
        </div>
        }
    </aside>
</div>
