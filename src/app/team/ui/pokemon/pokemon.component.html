<article class="pokemon-card">
  <header class="head">
    <img
      class="sprite"
      [src]="pokemon.sprite || 'assets/placeholder-poke.png'"
      [alt]="pokemon.name"
      loading="lazy"
      referrerpolicy="no-referrer"
    />
    <div class="title">
      <h3 class="name">{{ pokemon.name }}</h3>
      <!-- pokemon.component.html (sustituye la parte de tipos) -->
      @if (pokemon['typeDetails'].length) {
      <app-type-icon [typeDetails]="pokemon.typeDetails" [size]="20"></app-type-icon>
      } @else if (pokemon.types.length) {
      <!-- Fallback por si aún no tienes typeDetails -->
      <ul class="types">
        @for (name of pokemon.types; track $index) {
        <li class="type-pill">{{ name }}</li>
        }
      </ul>
      }
    </div>
  </header>

  @if (pokemon.stats.length) {
  <section class="stats">
    <h4 class="stats__title">Estadísticas</h4>
    <ul class="stats__list">
      @for (stat of pokemon.stats; track stat.name) {
      <li class="stats__item">
        <span class="stats__label">{{ stat.label }}</span>
        <div class="stats__bar">
          <div
            class="stats__bar-fill"
            [style.width.%]="getStatPercentage(stat)"
            [style.background]="getStatGradient(stat)"
          ></div>
        </div>
        <span class="stats__value">{{ stat.value }}</span>
      </li>
      }
    </ul>
  </section>
  }

  @if (pokemon.moves.length) {
  <section class="moves">
    <h4 class="moves__title">Movimientos</h4>
    <ul class="moves__list">
      @for (slot of moveSlots; track slot) {
      @let selected = pokemon.selectedMoves[slot];
      <li class="moves__item">
        <label class="moves__label" [attr.for]="'move-' + pokemon.id + '-' + slot">
          Movimiento {{ slot + 1 }}
        </label>
        <select
          class="moves__select"
          [id]="'move-' + pokemon.id + '-' + slot"
          [ngModel]="selected?.url ?? ''"
          (ngModelChange)="onMoveSelect(slot, $event)"
        >
          <option value="">Selecciona un movimiento</option>
          @for (move of pokemon.moves; track trackMove($index, move)) {
          <option [value]="move.url">{{ move.label }}</option>
          }
        </select>
        @if (selected) {
        <div class="moves__summary">
          <span class="moves__name">{{ selected.name }}</span>
          @if (selected.type) {
          <app-type-icon class="moves__type" [typeDetails]="[selected.type]" [size]="18"></app-type-icon>
          }
          <span class="moves__power">Poder: {{ selected.power ?? '—' }}</span>
        </div>
        }
      </li>
      }
    </ul>
  </section>
  }

  <footer class="actions">
    @if (showRemove) {
    <button type="button" class="btn-remove" (click)="onRemove()">Quitar</button>
    }
  </footer>
</article>
