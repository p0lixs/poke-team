<article class="pokemon-card">
  <header class="head">
    <img class="sprite" [src]="pokemon.sprite || 'assets/placeholder-poke.png'" [alt]="pokemon.name" loading="lazy"
      referrerpolicy="no-referrer" />
    <div class="title">
      <h3 class="name">{{ pokemon.name }}</h3>
      <!-- pokemon.component.html (sustituye la parte de tipos) -->
      @if (pokemon['typeDetails'].length) {
      <app-type-icon [typeDetails]="pokemon.typeDetails" [size]="100"></app-type-icon>
      } @else if (pokemon.types.length) {
      <!-- Fallback por si aún no tienes typeDetails -->
      <ul class="types">
        @for (name of pokemon.types; track $index) {
        <li class="type-pill">{{ name }}</li>
        }
      </ul>
      }
    </div>
  </header>

  @if (pokemon.stats.length) {
  <section class="stats">
    <h4 class="stats__title">Estadísticas</h4>
    <ul class="stats__list">
      @for (stat of pokemon.stats; track stat.name) {
      <li class="stats__item">
        <span class="stats__label">{{ stat.label }}</span>
        <div class="stats__bar">
          <div class="stats__bar-fill" [style.width.%]="getStatPercentage(stat)"
            [style.background]="getStatGradient(stat)"></div>
        </div>
        <span class="stats__value">{{ stat.value }}</span>
      </li>
      }
    </ul>
  </section>
  }

  @if (pokemon.moves.length) {
  <section class="moves">
    <h4 class="moves__title">Movimientos</h4>
    <ul class="moves__list">
      @for (slot of moveSlots; track slot) {
      @let selected = pokemon.selectedMoves[slot];
      <li class="moves__item">
        <ng-select class="moves__select" [items]="pokemon.moves" bindLabel="label" bindValue="url"
          [id]="'move-' + pokemon.id + '-' + slot" [placeholder]="'Movimiento ' + (slot + 1)"
          [clearable]="true" [ngModel]="selected?.url ?? null" (ngModelChange)="onMoveSelect(slot, $event)"
          [searchable]="true" [virtualScroll]="true">
          <ng-template ng-label-tmp let-item="item">
            @let icon = getMoveIcon(item);
            <div class="moves__option moves__option--selected">
              @if (icon) {
              <img class="moves__option-icon" [src]="icon" [alt]="item.type?.name ?? 'tipo'" />
              } @else if (item.type?.name) {
              <span class="moves__option-type moves__option-type--pill">{{ formatTypeName(item.type.name) }}</span>
              }
              <span class="moves__option-name">{{ item.label }}</span>
            </div>
          </ng-template>

          <ng-template ng-option-tmp let-item="item">
            @let icon = getMoveIcon(item);
            <div class="moves__option">
              @if (icon) {
              <img class="moves__option-icon" [src]="icon" [alt]="item.type?.name ?? 'tipo'" />
              } @else if (item.type?.name) {
              <span class="moves__option-type moves__option-type--pill">{{ formatTypeName(item.type.name) }}</span>
              }
              <div class="moves__option-text">
                <span class="moves__option-name">{{ item.label }}</span>
                <span class="moves__option-meta" *ngIf="item.type?.name || item.power !== null">
                  <span class="moves__option-type" *ngIf="item.type?.name">{{ formatTypeName(item.type.name) }}</span>
                  <span class="moves__option-power" *ngIf="item.power !== null">Poder: {{ item.power }}</span>
                </span>
              </div>
            </div>
          </ng-template>
        </ng-select>
        @if (selected) {
        <div class="moves__summary">
          @if (selected.type) {
          <app-type-icon class="moves__type" [typeDetails]="[selected.type]" [size]="70"></app-type-icon>
          }
          @if(selected.power !== null ){
          <span class="moves__power">Poder: {{ selected.power }}</span>
          }
        </div>
        }
      </li>
      }
    </ul>
  </section>
  }

  <footer class="actions">
    @if (showRemove) {
    <button type="button" class="btn-remove" (click)="onRemove()">Quitar</button>
    }
  </footer>
</article>